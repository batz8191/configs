############################################################################
# Startup
exec $HOME/bin/img.sh
exec synclient TapButton1=0 TapButton2=0 TapButton3=0 MinSpeed=1.5 MaxSpeed=2.7 AccelFactor=0.05
exec setxkbmap dvorak -option caps:swapescape -option compose:menu -option keypad:hex

exec trayer --SetDockType false --transparent true --expand false
exec nm-applet --sm-disable

# Permit focusing only transient windows
rudeness 13

set padding 0 0 0 20

exec xscreensaver -no-splash
exec $HOME/.ratpoison/status-short.pl
exec $HOME/.ratpoison/hub.pl > $HOME/.ratpoison/hub.log 2>&1
gnewbg junk
gnewbg extra
gnewbg systray
gselect 0
grename main

############################################################################
# Settings
msgwait 5
set bargravity center
set wingravity center
set transgravity center
set bgcolor black
set fgcolor yellow
#set fgcolor white
set fwcolor red
set bwcolor black
set font "Inconsolata:regular:size=20"
set inputwidth 1024
set resizeunit 20
set winfmt %n [%t]%s
set winname title
set framesels aoeuidhtns
startup_message off
warp off
escape s-t

############################################################################
# Unmanage
#unmanage panel
#unmanage xmobar
unmanage dzen2

############################################################################
# Aliases
alias update-hook exec $HOME/.ratpoison/list-windows

alias stats exec $HOME/.ratpoison/all_stats.pl

alias calc exec ratpoison -c 'msgwait 5' -c "echo `perl -I $HOME/code $HOME/bin/calc.pl -q "$(ratpoison -c 'prompt Calc: ')"`" -c 'msgwait 1'
alias dmenu exec dmenu_run -i -nb '#000000' -nf '#777777' -sb '#770000' -sf '#ffffff' -fn '-*-fixed-medium-r-normal-*-24-*-*-*-*-*-*-*' -p '> '
alias exec-in-terminal exec urxvt -e `ratpoison -c 'prompt urxvt -e '`
alias less exec urxvt -e less `ratpoison -c 'prompt less '`
alias man exec urxvt -e man `ratpoison -c 'prompt man '`
alias sshot exec import "$HOME/`ratpoison -c 'prompt Filename:'`"

alias last exec $HOME/.ratpoison/last
alias select-group exec ratpoison -c 'select -' -c "gselect `ratpoison -c "groups" | dmenu -l 10 -i -nb '#000000' -nf '#777777' -sb '#770000' -sf '#ffffff' -fn '-*-fixed-medium-r-normal-*-24-*-*-*-*-*-*-*' -p '> ' | awk -F'[\\\\*\\\\+\\\\- ]' '{print $1}'`" -c 'next'
alias select-window exec ratpoison -c "select `ratpoison -c "windows" | dmenu -l 10 -i -nb '#000000' -nf '#777777' -sb '#770000' -sf '#ffffff' -fn '-*-fixed-medium-r-normal-*-24-*-*-*-*-*-*-*' -p '> ' | awk '{print $1}'`"

alias cal exec $HOME/bin/dzen/dzen-cal.sh
#alias time exec ratpoison -c "echo $(date +"%a %m/%d/%Y %I:%M%p")"

alias renumber-left exec ratpoison -c "number `echo "x=$(ratpoison -c 'info %n') - 1; if (x < 0) { 0 } else { x }" | bc`" -c "update-hook"
alias renumber-right exec ratpoison -c "number `echo "$(ratpoison -c 'info %n') + 1" | bc`" -c "update-hook"
alias renumber-all exec $HOME/.ratpoison/renumber
alias renumber exec ratpoison -c "number $(ratpoison -c 'prompt Number: ')" -c update-hook

alias master-volume exec ratpoison -c "exec amixer sset Master $(ratpoison -c 'prompt Volume: ')% > /dev/null"
alias pcm-volume exec ratpoison -c "exec amixer sset PCM $(ratpoison -c 'prompt Volume: ')% > /dev/null"
#alias query-volume exec ratpoison -c "echo Master: `amixer get Master | ack-grep -o '\d+%' | head -n 1 | tr -d '[:cntrl:]'` PCM: `amixer get PCM | ack-grep -o '\d+'% | head -n 1 | tr -d '[:cntrl:]'`"

alias expose exec $HOME/.ratpoison/expose.pl
alias vgroups exec $HOME/.ratpoison/allwindows.sh

alias pass exec $HOME/code/dev/bpass/bpass.sh $HOME/code/dev/bpass/config.txt `ratpoison -c getsel`

# Also see http://www.shoutcast.com/radio/Jpop
alias mpd-play exec $HOME/.ratpoison/mpd_handler `cat $HOME/.ratpoison/stations | dmenu -l 10 -i -nb '#000000' -nf '#777777' -sb '#770000' -sf '#ffffff' -fn '-*-fixed-medium-r-normal-*-24-*-*-*-*-*-*-*' -p '> ' | awk '{print $2}'`
alias mpd-current exec mpc current -f '[[%artist% - ]%title%]' | xsel -ibp
alias mpd-echo exec ratpoison -c "echo `mpc current -f '[[%artist% - ]%title%]'`"
alias mpd-stop exec mpc stop
alias mpd-clear exec mpc clear

############################################################################
# Hooks
addhook switchwin update-hook
addhook switchframe update-hook
addhook switchgroup update-hook
addhook deletewindow update-hook
addhook titlechanged update-hook
#addhook urgent update-hook

############################################################################
# Top Map
definekey top s-semicolon colon
definekey top s-grave colon

# Exec
definekey top Print sshot
definekey top s-F11 calc
definekey top s-F exec google-chrome
definekey top s-C-F exec google-chrome --user-data-dir=$HOME/.config/google-chrome/testing
definekey top s-M-F exec google-chrome --user-data-dir=$HOME/.config/google-chrome/work
definekey top s-S-Return exec urxvt
definekey top s-L exec xscreensaver-command -lock
definekey top s-Scroll_Lock exec xscreensaver-command -lock
definekey top s-R dmenu
definekey top s-V exec gvim
definekey top s-Home exec setxkbmap us -option
definekey top s-End exec setxkbmap dvorak -option caps:swapescape -option compose:ralt
definekey top s-C-End exec sleep 1 && xset dpms force off
definekey top s-Next exec amixer -c0 sset Master 5%- >/dev/null
definekey top s-Prior exec amixer -c0 sset Master 5%+ >/dev/null

# Windows
definekey top s-w windows
definekey top s-1 select 0
definekey top s-2 select 1
definekey top s-3 select 2
definekey top s-4 select 3
definekey top s-5 select 4
definekey top s-6 select 5
definekey top s-7 select 6
definekey top s-8 select 7
definekey top s-9 select 8
definekey top s-0 select 9

definekey top M-F4 delete
definekey top M-S-F4 kill
definekey top M-Tab next
definekey top M-ISO_Left_Tab prev
definekey top s-n next
definekey top s-p prev
definekey top s-N renumber-right
definekey top s-P renumber-left
definekey top s-Tab focus
definekey top s-ISO_Left_Tab focusprev
definekey top s-o only
definekey top s-s split
definekey top s-u undo
definekey top s-v hsplit
definekey top s-C-s split 2/3
definekey top s-C-v hsplit 2/3
definekey top s-c exec  ratpoison -c 'select -' -c "gnew $(ratpoison -c 'prompt Name: ')" -c 'next'
definekey top s-C gdelete
definekey top s-r remove
definekey top s-Escape last
definekey top s-minus select -

# Frames
definekey top s-C-1 fselect 0
definekey top s-C-2 fselect 1
definekey top s-C-3 fselect 2
definekey top s-C-4 fselect 3
definekey top s-C-5 fselect 4
definekey top s-C-6 fselect 5
definekey top s-C-7 fselect 6
definekey top s-C-8 fselect 7
definekey top s-C-9 fselect 8
definekey top s-C-0 fselect 9

definekey top s-h focusleft
definekey top s-j focusdown
definekey top s-k focusup
definekey top s-l focusright

definekey top s-H exchangeleft
definekey top s-J exchangedown
definekey top s-K exchangesup
definekey top s-L exchangeright

# Groups
definekey top s-G select-group
definekey top s-comma exec $HOME/.ratpoison/gnext.pl prev
definekey top s-period exec $HOME/.ratpoison/gnext.pl next
definekey top s-F1 exec ratpoison -c 'select -' -c 'gselect 0' -c 'next'
definekey top s-F2 exec ratpoison -c 'select -' -c 'gselect 1' -c 'next'
definekey top s-F3 exec ratpoison -c 'select -' -c 'gselect 2' -c 'next'
definekey top s-F4 exec ratpoison -c 'select -' -c 'gselect 3' -c 'next'
definekey top s-F5 exec ratpoison -c 'select -' -c 'gselect 4' -c 'next'
definekey top s-F6 exec ratpoison -c 'select -' -c 'gselect 5' -c 'next'

definekey top s-S-F1 gmove 0
definekey top s-S-F2 gmove 1
definekey top s-S-F3 gmove 2
definekey top s-S-F4 gmove 3
definekey top s-S-F5 gmove 4
definekey top s-S-F6 gmove 5

############################################################################
# Unbindings
unbind Q

############################################################################
# Root map
bind semicolon colon
bind colon colon
bind grave colon
bind s-grave colon
bind exclam exec-in-terminal
bind Return exec urxvt
bind 1 fselect 0
bind 2 fselect 1
bind 3 fselect 2
bind 4 fselect 3
bind 5 fselect 4
bind 6 fselect 5
bind 7 fselect 6
bind 8 fselect 7
bind 9 fselect 8
bind 0 fselect 9
bind w windows
bind s-w windows
bind apostrophe select-window
bind A title
bind t other
bind s-t other
bind n inext
bind s-n inext
bind p iprev
bind s-p iprev
bind R renumber
bind G vgroups
bind q expose
bind a stats
bind s-a stats
bind o only
bind s split
bind S hsplit
# TODO maybe make this toggle?
bind M-b banish
bind B ratwarp 500 500
bind b exec $HOME/.ratpoison/toggle-hide.pl
bind s-b exec $HOME/.ratpoison/toggle-hide.pl
bind f fselect
bind s-f fselect
bind T meta
bind h focusleft
bind s-h focusleft
bind j focusdown
bind s-j focusdown
bind k focusup
bind s-k focusup
bind l focusright
bind s-l focusright
bind K kill
bind Escape abort

############################################################################
# Exec map
newkmap exec
bind e readkey exec
bind s-e readkey exec
definekey exec Return exec urxvt
definekey exec c exec wxmaxima
definekey exec f exec google-chrame
definekey exec e exec urxvt -e mc
definekey exec Escape abort

############################################################################
# Group map
newkmap group
bind g readkey group
bind s-g readkey group
definekey group c gnew

definekey group g exec ratpoison -c 'select -' -c 'gother' -c 'next'
definekey group s-g exec ratpoison -c 'select -' -c 'gother' -c 'next'
definekey group apostrophe select-group
definekey group comma exec $HOME/.ratpoison/gnext.pl prev
definekey group period exec $HOME/.ratpoison/gnext.pl next
definekey group p exec $HOME/.ratpoison/gnext.pl prev
definekey group n exec $HOME/.ratpoison/gnext.pl next
definekey group 1 exec ratpoison -c 'select -' -c 'gselect 0' -c 'next'
definekey group 2 exec ratpoison -c 'select -' -c 'gselect 1' -c 'next'
definekey group 3 exec ratpoison -c 'select -' -c 'gselect 2' -c 'next'
definekey group 4 exec ratpoison -c 'select -' -c 'gselect 3' -c 'next'
definekey group 5 exec ratpoison -c 'select -' -c 'gselect 4' -c 'next'
definekey group 6 exec ratpoison -c 'select -' -c 'gselect 5' -c 'next'

definekey group exclam gmove 0
definekey group at gmove 1
definekey group numbersign gmove 2
definekey group dollar gmove 3
definekey group percent gmove 4
definekey group asciicircum gmove 5
definekey group ampersand gmove 6
definekey group Escape abort

############################################################################
# Volume map
newkmap volume
bind v readkey volume
bind s-v readkey volume
definekey volume m exec $HOME/.i3/mute.sh
definekey volume v exec $HOME/.i3/mute.sh
definekey volume grave exec amixer sset Master 0
definekey volume 1 exec amixer sset Master 10
definekey volume 2 exec amixer sset Master 20
definekey volume 3 exec amixer sset Master 30
definekey volume 4 exec amixer sset Master 40
definekey volume 5 exec amixer sset Master 50
definekey volume 6 exec amixer sset Master 60
definekey volume 7 exec amixer sset Master 70
definekey volume 8 exec amixer sset Master 80
definekey volume 9 exec amixer sset Master 90
definekey volume 0 exec amixer sset Master 100
definekey volume p master-volume
definekey volume Escape abort

############################################################################
# mpd map
newkmap mpd
bind m readkey mpd
bind s-m readkey mpd
definekey mpd p mpd-play
definekey mpd c mpd-current
definekey mpd e mpd-echo
definekey mpd r exec mpc play
definekey mpd s mpd-stop
definekey mpd l mpd-clear
definekey mpd Escape abort

############################################################################
# clipboard map
newkmap yank
bind Y readkey yank
definekey yank a exec ratpoison -c getsel > /tmp/rpastea
definekey yank b exec ratpoison -c getsel > /tmp/rpasteb
definekey yank c exec ratpoison -c getsel > /tmp/rpastec
definekey yank d exec ratpoison -c getsel > /tmp/rpasted
definekey yank e exec ratpoison -c getsel > /tmp/rpastee

newkmap put
bind P readkey put
definekey put a exec xte "keyup a" "str `cat /tmp/rpastea`"
definekey put b exec xte "keyup b" "str `cat /tmp/rpasteb`"
definekey put c exec xte "keyup c" "str `cat /tmp/rpastec`"
definekey put d exec xte "keyup d" "str `cat /tmp/rpasted`"
definekey put e exec xte "keyup e" "str `cat /tmp/rpastee`"
